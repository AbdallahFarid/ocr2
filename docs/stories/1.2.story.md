# 1.2 — Bank & Template Classifier

## Status
Approved

## Story
**As a** system,
**I want** to classify cheques by bank/template,
**so that** I can route to the correct template or a generic fallback path.

## Acceptance Criteria
1. Given a cheque image, classifier returns bank/template label with confidence.
2. For unknown banks, system routes to generic locator.
3. Evaluate MobileNetV3 baseline on labeled samples and store metrics.

## Dev Notes (Architecture References)
- Classifier design [Source: architecture/components.md#2-bank-template-classifier]
- Tech stack [Source: architecture/tech-stack.md]
- Coding conventions [Source: architecture/coding-standards.md]
- Testing [Source: architecture/testing-strategy.md]

### Testing
- Test file location: `backend/tests/ocr/test_classifier.py`
- Standards: follow `docs/architecture/coding-standards.md`; target ≥ 85% coverage on core logic
- Frameworks: `pytest`; include dataset/versioning checks
- Story-specific: verify unknown-bank fallback routing; persist metrics per `testing-strategy.md`

## Tasks / Subtasks
- [x] Implement classifier wrapper in `backend/app/ocr/classifier.py`.
- [x] Define labels (QNB, FABMISR, UNKNOWN) in `backend/app/ocr/labels.py`; model versioning TBD; persist predictions/metrics TBD.
- [x] Write tests under `backend/tests/ocr/test_classifier.py`.
- [ ] Add fallback routing logic and logs.

## Project Structure Notes
- Model artifacts tracked under `/models/` with versioning.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-14 | 0.1.0 | Implemented classifier Option 3 (stub + heuristic + mobilenet scaffold) with tests | dev-agent |

## Dev Agent Record
### Agent Model Used
Cascade

### Debug Log References
N/A

### Completion Notes List
- Added classifier facade with engine selection via env `CLASSIFIER_ENGINE` (stub|heuristic|mobilenet).
- Implemented heuristic engine with template matching (optional) and layout-based brightness heuristic for QNB/FABMISR.
- Added stub engine for stable CI; mobilenet engine scaffold for future model.
- Tests created for all three engines.

### File List
- backend/app/config.py (updated: DEFAULT_CLASSIFIER)
- backend/app/ocr/classifier.py (new)
- backend/app/ocr/labels.py (new)
- backend/app/ocr/engines/__init__.py (new)
- backend/app/ocr/engines/stub.py (new)
- backend/app/ocr/engines/heuristic.py (new)
- backend/app/ocr/engines/mobilenet.py (new)
- backend/tests/ocr/test_classifier.py (new)

## QA Results

