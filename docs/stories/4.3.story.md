# 4.3 — ERP/AP API Push and Retry Logic

## Status
Approved

## Story
**As a** system,
**I want** to push validated cheques to the ERP/AP system via API with retries,
**so that** no approved cheque is dropped.

## Acceptance Criteria
1. API client implemented with auth and error handling.
2. Retry with backoff on transient failures; dead-letter queue for persistent errors.
3. All pushes logged; success/failure metrics exposed.

## Dev Notes (Architecture References)
- Export + Integration [Source: architecture/components.md#9-export-integration]
- Monitoring [Source: architecture/components.md#10-monitoring]
- Coding standards [Source: architecture/coding-standards.md]

### Testing
- Test file location: `backend/tests/services/test_erp_client.py`
- Standards: follow `docs/architecture/coding-standards.md`; target ≥ 85% coverage on client/retry logic
- Frameworks: `pytest`
- Story-specific: verify retries with backoff and dead-letter handling; ensure idempotency per `testing-strategy.md`

## Tasks / Subtasks
- Implement API client `backend/app/services/erp_client.py`.
- Celery task to push approved cheques and handle retries.
- Tests for client and retry logic.

## Project Structure Notes
- Ensure idempotency to avoid duplicate records in ERP/AP.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

