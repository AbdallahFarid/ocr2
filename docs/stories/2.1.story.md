# 2.1 — Validation Gates (Dates, Amounts, Cheque Numbers, Payee, Currency)

## Status
In Progress

## Story
**As a** system,
**I want** deterministic validation gates for key fields,
**so that** invalid cheques are reliably caught and routed to reviewers.

## Acceptance Criteria
1. Date is within a plausible range; invalid/ambiguous dates flagged with codes.
2. Amount is > 0 and within configured business thresholds.
3. Cheque number length/patterns validated per bank; errors use bank-specific codes.
4. Payee validated against master list with fuzzy matching and threshold; non-matches flagged.
5. Currency must be within the allowed set.
6. All failures return machine-readable error codes and explanations.
7. Unit tests and property-based tests for edge cases.

## Dev Notes (Architecture References)
- Validation Gates [Source: architecture/components.md#6-validation-gates]
- Data model for error recording [Source: architecture/data-model-core-tables.md#errors]
- Coding standards [Source: architecture/coding-standards.md]
- Testing strategy [Source: architecture/testing-strategy.md]
- Project structure [Source: architecture/unified-project-structure.md]

### Testing
- Test file location: `backend/tests/validations/test_gates.py`
- Standards: follow `docs/architecture/coding-standards.md`; target ≥ 85% coverage
- Frameworks: `pytest`; include property-based tests for dates/amounts
- Story-specific: verify error code mapping and bank-specific patterns per `testing-strategy.md`

## Tasks / Subtasks
- [x] Implement validators in `backend/app/validations/gates.py`.
- [x] Implement bank-specific cheque number patterns in config or DB metadata.
- [x] Implement payee fuzzy validation (baseline via `difflib` with threshold; RapidFuzz optional upgrade).
- [x] Create error codes and enums in `backend/app/validations/error_codes.py`.
- [x] Tests in `backend/tests/validations/test_gates.py` (baseline unit tests).
- [ ] Persist validation results and errors for each cheque.

## Project Structure Notes
- Keep validators pure for testability; wrap I/O at service boundaries.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-15 | 0.1.0 | Started 2.1; added validators, error codes, and baseline tests | dev-agent |
| 2025-09-15 | 0.2.0 | Added bank-specific cheque number patterns and updated aggregator to pass bank ID | dev-agent |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List
- backend/app/validations/error_codes.py (new)
- backend/app/validations/gates.py (new)
- backend/app/validations/__init__.py (new)
- backend/tests/validations/test_gates.py (new)

## QA Results

