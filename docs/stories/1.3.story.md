# 1.3 — Field Locator (Known + Unknown Templates)

## Status
Approved

## Story
**As a** system,
**I want** to locate fields either via template anchors or via key-phrase/layout model fallback,
**so that** I can crop inputs for OCR.

## Acceptance Criteria
1. For known templates, anchors map to bboxes with perspective correction.
2. For unknown templates, key-phrase and/or layout model identifies label→value regions.
3. Locator returns source bbox JSON per field with confidences.

## Dev Notes (Architecture References)
- Locator details [Source: architecture/components.md#3-field-locator]
- Tech stack [Source: architecture/tech-stack.md]
- Coding conventions [Source: architecture/coding-standards.md]
- Testing [Source: architecture/testing-strategy.md]

### Testing
- Test file location: `backend/tests/ocr/test_locator.py`
- Standards: follow `docs/architecture/coding-standards.md`; target ≥ 85% coverage on core logic
- Frameworks: `pytest`
- Story-specific: cover both known-template anchors and unknown-template fallback paths per `testing-strategy.md`

## Tasks / Subtasks
- [x] Implement anchor-based locator `backend/app/ocr/locator.py`.
- [ ] Implement fallback locator using key-phrases and optional detection model.
- [x] Tests: `backend/tests/ocr/test_locator.py` with known templates and unknown samples.

## Project Structure Notes
- Configuration of templates stored in `banks.template_meta` and versioned.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-14 | 0.1.0 | Implemented FABMISR template + anchor/regex locator with tests | dev-agent |

## Dev Agent Record
### Agent Model Used
Cascade

### Debug Log References
N/A

### Completion Notes List
- Added template-based locator with regex search for bank_name/date/cheque_number/amount and anchor-left logic for name via 'Signatory name'.
- Template stored at `backend/app/ocr/templates/FABMISR/default.json` with roi_norm and region_norm.
- Utilities for normalized→pixel conversion created.
- Unit tests added to validate field location and bbox sanity.

### File List
- backend/app/ocr/locator_utils.py (new)
- backend/app/ocr/locator.py (new)
- backend/app/ocr/templates/FABMISR/default.json (new)
- backend/tests/ocr/test_locator.py (new)

## QA Results

