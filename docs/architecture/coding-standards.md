# Coding Standards

This document defines coding conventions and quality gates for the Cheque Processing Platform to ensure correctness, maintainability, and auditability.

## Backend (Python / FastAPI / Celery)
- Type hints are mandatory. Enable `mypy` in CI.
- Formatting: `black` + `isort` (line length 100).
- Linting: `ruff` (or `flake8`) with no warnings in CI.
- API design:
  - Define schemas with Pydantic models. All endpoints return typed responses.
  - OpenAPI auto-generated by FastAPI must be valid.
  - Use explicit status codes and error models.
- Services and tasks:
  - Separate I/O from pure logic. Keep pure functions easily testable.
  - Celery tasks must be idempotent; retries configured with backoff.
- Database (Postgres):
  - Use migrations (Alembic). No direct DDL in code.
  - Transactions around multi-step writes. Avoid partial commits.
- Validation & parsing:
  - Deterministic regex/grammars for parsing; no silent fallbacks.
  - All validation failures must return machine-readable error codes.
- Logging & observability:
  - Structured logging (JSON). Include correlation IDs per cheque.
  - Log levels: DEBUG in dev, INFO in prod; PII redaction.
- Testing:
  - `pytest` with coverage â‰¥ 85% on core parsing/validation modules.
  - Property-based tests for parsers and validators where feasible.

## Computer Vision / OCR
- Engines: OpenCV + PaddleOCR; layout models (Detectron2/YOLOv8) for unknown templates.
- Reproducibility: pin model versions and random seeds; document training data.
- Confidence calculation must be deterministic and persisted per field.
- MICR recognition uses dedicated models; always store pre/post-processed crops for audit.

## Frontend (React + shadcn/ui)
- Use TypeScript everywhere. No `any` unless justified with comments.
- Formatting: Prettier; Linting: ESLint (strict recommended).
- State management: prefer local state + hooks; introduce global state only when needed.
- Accessibility: adhere to WAI-ARIA; keyboard navigation required for reviewer console.
- i18n: Arabic + English support via a single i18n framework.
- Testing: unit tests for components with critical logic; integration tests for reviewer flows.

## Security & Compliance
- Secrets via environment or secret manager; never commit.
- Encrypt at rest and in transit. Use TLS for all APIs.
- PII handling: minimize data retention; audit access to cheque images and fields.
- Authorization: role-based checks on reviewer/admin features.

## Git & Reviews
- Conventional Commits: `feat:`, `fix:`, `docs:`, `refactor:`, etc.
- PRs require at least one reviewer approval and passing CI.
- Include links to related PRD/Architecture shard in PR descriptions.
